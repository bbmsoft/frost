<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frost</title>
    <script type="module">
        import init from "/frost.js"
        import * as frost from "/frost.js"

        async function start_app() {
            await init()
            const navigator = window.navigator
            if (navigator.geolocation) {
                const geolocation = navigator.geolocation
                frost.start(() => get_location(geolocation))
            } else {
                frost.start()
            }
        }

        async function get_location(geolocation) {
            const success = position => frost.set_location(position.coords.latitude, position.coords.longitude, () => get_location(geolocation))
            const error = e => {
                alert(`Failed to get location: ${e.message}.`)
                frost.get_location_failed(e.code, e.message)
            }
            const options = { timeout: 3000, enableHighAccuracy: false, maximumAge: 3600 }
            geolocation.getCurrentPosition(success, error, options)
        }

        start_app()

    </script>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
    <div class="app">
        <div class="splash">
            <span class="loading">Loading App</span>
            <img class="progress-indicator" src="/loading.gif" alt="progress indicator">
        </div>
    </div>
</body>

</html>